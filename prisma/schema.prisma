generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =============================================================================
// PROFILE DOMAIN - Core user/worker/candidate profiles
// =============================================================================

model Profile {
  id                             String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  candidateCode                  String?
  workerCode                     String?
  phone                          String?
  altPhone                       String?
  email                          String?
  firstName                      String?
  middleName                     String?
  lastName                       String?
  fathersName                    String?
  gender                         String?
  dateOfBirth                    DateTime?                    @db.Date
  isActive                       Boolean?
  createdAt                      DateTime?                    @db.Timestamptz(6)
  updatedAt                      DateTime?                    @db.Timestamptz(6)
  profilePhotoURL                String?
  deletedAt                      DateTime?                    @db.Timestamptz(6)
  deletedByProfileId             String?                      @db.Uuid
  emergencyContactName           String?
  emergencyContactNumber         String?
  nomineeName                    String?
  bloodGroup                     String?
  candidateApprovedAt            DateTime?                    @db.Timestamptz(6)
  candidateApprovedByProfileId   String?                      @db.Uuid
  workerConvertedAt              DateTime?                    @db.Timestamptz(6)
  candidateCodeAssignedAt        DateTime?                    @db.Timestamptz(6)
  workerCodeAssignedAt           DateTime?                    @db.Timestamptz(6)
  passwordHash                   String?
  undeletedAt                    DateTime?                    @db.Timestamptz(6)
  undeletedByProfileId           String?                      @db.Uuid
  deactivatedAt                  DateTime?                    @db.Timestamptz(6)
  deactivatedByProfileId         String?                      @db.Uuid
  reactivatedAt                  DateTime?                    @db.Timestamptz(6)
  reactivatedByProfileId         String?                      @db.Uuid
  currentStage                   String?
  metadata                       Json?
  isVerified                     Boolean?
  verifiedAt                     DateTime?                    @db.Timestamptz(6)
  verifiedByProfileId            String?                      @db.Uuid
  workerType                     String?
  profileType                    String?
  activityLogs                   ActivityLog[]
  calendarEvents                 CalendarEvent[]
  employerStatusHistory          EmployerStatusHistory[]
  deletedEmployers               Employer[]                   @relation("employers_deletedByProfileIdToprofiles")
  verifiedEmployers              Employer[]                   @relation("employers_verifiedByProfileIdToprofiles")
  notificationPreferences        NotificationPreference[]
  receivedNotifications          Notification[]               @relation("notifications_recipientProfileIdToprofiles")
  sentNotifications              Notification[]               @relation("notifications_senderProfileIdToprofiles")
  addresses                      ProfileAddress[]
  bankAccounts                   ProfileBankAccount[]
  assignedCategoryAssignments    ProfileCategoryAssignment[]  @relation("profile_category_assignments_assignedByProfileIdToprofiles")
  categoryAssignments            ProfileCategoryAssignment[]  @relation("profile_category_assignments_profileIdToprofiles")
  documents                      ProfileDocument[]            @relation("profile_documents_profileIdToprofiles")
  uploadedDocuments              ProfileDocument[]            @relation("profile_documents_uploadedByProfileIdToprofiles")
  identity                       ProfileIdentity?
  createdInteractions            ProfileInteraction[]         @relation("profile_interactions_createdByProfileIdToprofiles")
  interactions                   ProfileInteraction[]         @relation("profile_interactions_profileIdToprofiles")
  qualifications                 ProfileQualification[]
  assignedRoleAssignments        ProfileRoleAssignment[]      @relation("profile_role_assignments_assignedByProfileIdToprofiles")
  roleAssignments                ProfileRoleAssignment[]      @relation("profile_role_assignments_profileIdToprofiles")
  skills                         ProfileSkill[]
  changedStageHistory            ProfileStageHistory[]        @relation("profile_stage_history_changedByProfileIdToprofiles")
  stageHistory                   ProfileStageHistory[]        @relation("profile_stage_history_profileIdToprofiles")
  issuedCertificates             ProfileTrainingCertificate[] @relation("profile_training_certificates_issuedByProfileIdToprofiles")
  trainingCertificates           ProfileTrainingCertificate[] @relation("profile_training_certificates_profileIdToprofiles")
  candidateApprovedByProfile     Profile?                     @relation("profiles_candidateApprovedByProfileIdToprofiles", fields: [candidateApprovedByProfileId], references: [id])
  approvedCandidates             Profile[]                    @relation("profiles_candidateApprovedByProfileIdToprofiles")
  deactivatedByProfile           Profile?                     @relation("profiles_deactivatedByProfileIdToprofiles", fields: [deactivatedByProfileId], references: [id])
  deactivatedProfiles            Profile[]                    @relation("profiles_deactivatedByProfileIdToprofiles")
  deletedByProfile               Profile?                     @relation("profiles_deletedByProfileIdToprofiles", fields: [deletedByProfileId], references: [id])
  deletedProfiles                Profile[]                    @relation("profiles_deletedByProfileIdToprofiles")
  reactivatedByProfile           Profile?                     @relation("profiles_reactivatedByProfileIdToprofiles", fields: [reactivatedByProfileId], references: [id])
  reactivatedProfiles            Profile[]                    @relation("profiles_reactivatedByProfileIdToprofiles")
  undeletedByProfile             Profile?                     @relation("profiles_undeletedByProfileIdToprofiles", fields: [undeletedByProfileId], references: [id])
  undeletedProfiles              Profile[]                    @relation("profiles_undeletedByProfileIdToprofiles")
  verifiedByProfile              Profile?                     @relation("profiles_verifiedByProfileIdToprofiles", fields: [verifiedByProfileId], references: [id])
  verifiedProfiles               Profile[]                    @relation("profiles_verifiedByProfileIdToprofiles")
  languages                      ProfileLanguage[]
  projectDocuments               ProjectDocument[]
  reviewedProjectRequests        ProjectRequest[]
  changedProjectStageHistory     ProjectStageHistory[]
  assignedWorkerAssignments      ProjectWorkerAssignment[]    @relation("project_worker_assignments_assignedByProfileIdToprofiles")
  workerAssignments              ProjectWorkerAssignment[]    @relation("project_worker_assignments_profileIdToprofiles")
  removedWorkerAssignments       ProjectWorkerAssignment[]    @relation("project_worker_assignments_removedByProfileIdToprofiles")
  sharedWorkerAssignments        ProjectWorkerAssignment[]    @relation("project_worker_assignments_sharedByProfileIdToprofiles")
  createdProjects                Project[]                    @relation("projects_createdByProfileIdToprofiles")
  deletedProjects                Project[]                    @relation("projects_deletedByProfileIdToprofiles")
  managedProjects                Project[]                    @relation("projects_projectManagerProfileIdToprofiles")
  enrolledByBatchEnrollments     TrainingBatchEnrollment[]    @relation("training_batch_enrollments_enrolledByProfileIdToprofiles")
  forceCompletedBatchEnrollments TrainingBatchEnrollment[]    @relation("training_batch_enrollments_forceCompletedByProfileIdToprofiles")
  batchEnrollments               TrainingBatchEnrollment[]    @relation("training_batch_enrollments_profileIdToprofiles")
  assignedAsTrainer              TrainingBatchTrainer[]       @relation("training_batch_trainers_assignedByProfileIdToprofiles")
  trainerAssignments             TrainingBatchTrainer[]       @relation("training_batch_trainers_trainerProfileIdToprofiles")
  createdTrainingBatches         TrainingBatch[]
  createdTrainingHistory         TrainingHistory[]            @relation("training_history_createdByProfileIdToprofiles")
  trainingHistory                TrainingHistory[]            @relation("training_history_profileIdToprofiles")

  @@map("profiles")
}

model ProfileIdentity {
  id                        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId                 String    @unique @db.Uuid
  // Aadhaar
  aadhaarNumber             String?
  aadhaarDocumentId         String?   @db.Uuid
  // PAN
  panNumber                 String?
  panDocumentId             String?   @db.Uuid
  // ESIC
  esicNumber                String?
  esicDocumentId            String?   @db.Uuid
  // UAN
  uanNumber                 String?
  uanDocumentId             String?   @db.Uuid
  // PF
  pfAccountNumber           String?
  pfDocumentId              String?   @db.Uuid
  // Health Insurance
  healthInsurancePolicy     String?
  healthInsuranceProvider   String?
  healthInsuranceExpiry     DateTime? @db.Date
  healthInsuranceDocumentId String?   @db.Uuid
  // Timestamps
  createdAt                 DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt                 DateTime  @db.Timestamptz(6)
  profile                   Profile   @relation(fields: [profileId], references: [id])

  @@map("profile_identity")
}

model ProfileAddress {
  id            String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  addressType   String?
  houseNumber   String?
  villageOrCity String?
  district      String?
  state         String?
  postalCode    String?
  landmark      String?
  policeStation String?
  postOffice    String?
  profileId     String?          @db.Uuid
  documentId    String?          @db.Uuid
  profile       Profile?         @relation(fields: [profileId], references: [id])
  document      ProfileDocument? @relation(fields: [documentId], references: [id])
  createdAt     DateTime?        @db.Timestamptz(6)
  updatedAt     DateTime?        @db.Timestamptz(6)

  @@map("profile_addresses")
}

model ProfileBankAccount {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  accountHolderName String?
  accountNumber     String?
  ifscCode          String?
  bankName          String?
  branchName        String?
  accountType       String?
  isPrimary         Boolean?
  createdAt         DateTime?        @db.Timestamptz(6)
  updatedAt         DateTime?        @db.Timestamptz(6)
  profileId         String?          @db.Uuid
  documentId        String?          @db.Uuid
  profile           Profile?         @relation(fields: [profileId], references: [id])
  document          ProfileDocument? @relation(fields: [documentId], references: [id])

  @@map("profile_bank_accounts")
}

model ProfileStageHistory {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId          String?   @db.Uuid
  previousStage      String?
  newStage           String?
  reason             String?
  metadata           Json?
  changedByProfileId String?   @db.Uuid
  changedAt          DateTime? @db.Timestamptz(6)
  changedByProfile   Profile?  @relation("profile_stage_history_changedByProfileIdToprofiles", fields: [changedByProfileId], references: [id])
  profile            Profile?  @relation("profile_stage_history_profileIdToprofiles", fields: [profileId], references: [id])

  @@map("profile_stage_history")
}

// -----------------------------------------------------------------------------
// Profile Skills & Categories
// -----------------------------------------------------------------------------

model ProfileSkill {
  id                String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  yearsOfExperience Int?
  isPrimary         Boolean?
  createdAt         DateTime?      @db.Timestamptz(6)
  updatedAt         DateTime?      @db.Timestamptz(6)
  profileId         String?        @db.Uuid
  skillCategoryId   String?        @db.Uuid
  profile           Profile?       @relation(fields: [profileId], references: [id])
  skillCategory     SkillCategory? @relation(fields: [skillCategoryId], references: [id])

  @@map("profile_skills")
}

model SkillCategory {
  id                   String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String?
  categoryType         String?
  createdAt            DateTime?                    @db.Timestamptz(6)
  updatedAt            DateTime?                    @db.Timestamptz(6)
  workerType           String?                      @db.VarChar(20)
  profileSkills        ProfileSkill[]
  requestRequirements  ProjectRequestRequirement[]
  resourceRequirements ProjectResourceRequirement[]

  @@index([workerType], map: "idx_skill_categories_worker_type")
  @@map("skill_categories")
}

model ProfileCategory {
  id          String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String?
  workerType  String?                     @db.VarChar(20)
  createdAt   DateTime?                   @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime?                   @default(now()) @db.Timestamptz(6)
  assignments ProfileCategoryAssignment[]

  @@index([workerType], map: "idx_profile_categories_worker_type")
  @@map("profile_categories")
}

model ProfileCategoryAssignment {
  id                  String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId           String?          @db.Uuid
  categoryId          String?          @db.Uuid
  assignedAt          DateTime?        @db.Timestamptz(6)
  assignedByProfileId String?          @db.Uuid
  metadata            Json?
  assignedByProfile   Profile?         @relation("profile_category_assignments_assignedByProfileIdToprofiles", fields: [assignedByProfileId], references: [id])
  category            ProfileCategory? @relation(fields: [categoryId], references: [id])
  profile             Profile?         @relation("profile_category_assignments_profileIdToprofiles", fields: [profileId], references: [id])

  @@index([categoryId], map: "idx_profile_category_assignments_category_id")
  @@index([profileId], map: "idx_profile_category_assignments_profile_id")
  @@map("profile_category_assignments")
}

// -----------------------------------------------------------------------------
// Profile Qualifications
// -----------------------------------------------------------------------------

model ProfileQualificationType {
  id             String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name           String?
  qualifications ProfileQualification[]

  @@map("profile_qualification_types")
}

model ProfileQualification {
  id                  String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  institutionName     String?
  fieldOfStudy        String?
  yearOfCompletion    Int?
  percentageOrGrade   String?
  createdAt           DateTime?                 @db.Timestamptz(6)
  profileId           String?                   @db.Uuid
  qualificationTypeId String?                   @db.Uuid
  documentId          String?                   @db.Uuid
  document            ProfileDocument?          @relation(fields: [documentId], references: [id])
  profile             Profile?                  @relation(fields: [profileId], references: [id])
  qualificationType   ProfileQualificationType? @relation(fields: [qualificationTypeId], references: [id])

  @@map("profile_qualifications")
}

// -----------------------------------------------------------------------------
// Profile Documents
// -----------------------------------------------------------------------------

model DocumentCategory {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String?
  description   String?
  createdAt     DateTime?      @db.Timestamptz(6)
  updatedAt     DateTime?      @db.Timestamptz(6)
  documentTypes DocumentType[]

  @@map("document_categories")
}

model DocumentType {
  id               String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  categoryId       String?           @db.Uuid
  name             String?
  createdAt        DateTime?         @db.Timestamptz(6)
  updatedAt        DateTime?         @db.Timestamptz(6)
  documentCategory DocumentCategory? @relation(fields: [categoryId], references: [id])
  profileDocuments ProfileDocument[]

  @@map("document_types")
}

model ProfileDocument {
  id                  String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId           String?                @db.Uuid
  documentUrl         String?
  uploadedByProfileId String?                @db.Uuid
  createdAt           DateTime?              @db.Timestamptz(6)
  updatedAt           DateTime?              @db.Timestamptz(6)
  documentNumber      String?                @db.VarChar(100)
  documentTypeId      String?                @db.Uuid
  documentType        DocumentType?          @relation(fields: [documentTypeId], references: [id])
  profile             Profile?               @relation("profile_documents_profileIdToprofiles", fields: [profileId], references: [id])
  uploadedByProfile   Profile?               @relation("profile_documents_uploadedByProfileIdToprofiles", fields: [uploadedByProfileId], references: [id])
  qualifications      ProfileQualification[]
  addresses           ProfileAddress[]
  bankAccounts        ProfileBankAccount[]

  @@map("profile_documents")
}

// -----------------------------------------------------------------------------
// Profile Languages
// -----------------------------------------------------------------------------

model Language {
  id               String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  createdAt        DateTime?         @db.Timestamptz(6)
  updatedAt        DateTime?         @db.Timestamptz(6)
  name             String?
  profileLanguages ProfileLanguage[]

  @@map("languages")
}

model ProfileLanguage {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId  String?   @db.Uuid
  languageId String?   @db.Uuid
  createdAt  DateTime? @db.Timestamptz(6)
  language   Language? @relation(fields: [languageId], references: [id])
  profile    Profile?  @relation(fields: [profileId], references: [id])

  @@unique([profileId, languageId])
  @@map("profiles_languages")
}

// -----------------------------------------------------------------------------
// Profile Interactions
// -----------------------------------------------------------------------------

model ProfileInteractionType {
  id           String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type         String?
  interactions ProfileInteraction[]

  @@map("profile_interaction_types")
}

model ProfileInteraction {
  id                 String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  interactionDate    DateTime?               @db.Timestamptz(6)
  subject            String?
  description        String?
  createdAt          DateTime?               @db.Timestamptz(6)
  updatedAt          DateTime?               @db.Timestamptz(6)
  profileId          String?                 @db.Uuid
  createdByProfileId String?                 @db.Uuid
  interactionTypeId  String?                 @db.Uuid
  createdByProfile   Profile?                @relation("profile_interactions_createdByProfileIdToprofiles", fields: [createdByProfileId], references: [id])
  interactionType    ProfileInteractionType? @relation(fields: [interactionTypeId], references: [id])
  profile            Profile?                @relation("profile_interactions_profileIdToprofiles", fields: [profileId], references: [id])

  @@map("profile_interactions")
}

// -----------------------------------------------------------------------------
// Profile Roles & Permissions
// -----------------------------------------------------------------------------

model ProfileRole {
  id          String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String?
  createdAt   DateTime?               @db.Timestamptz(6)
  updatedAt   DateTime?               @db.Timestamptz(6)
  assignments ProfileRoleAssignment[]
  permissions ProfileRolePermission[]

  @@map("profile_roles")
}

model ProfileRolePermission {
  id           String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  roleId       String?      @db.Uuid
  moduleName   String?
  canView      Boolean?
  canManage    Boolean?
  canExport    Boolean?
  isSuperAdmin Boolean?
  createdAt    DateTime?    @db.Timestamptz(6)
  updatedAt    DateTime?    @db.Timestamptz(6)
  role         ProfileRole? @relation(fields: [roleId], references: [id])

  @@map("profile_role_permissions")
}

model ProfileRoleAssignment {
  id                  String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId           String?      @db.Uuid
  roleId              String?      @db.Uuid
  assignedByProfileId String?      @db.Uuid
  assignedAt          DateTime?    @db.Timestamptz(6)
  revokedAt           DateTime?    @db.Timestamptz(6)
  revokedByProfileId  String?      @db.Uuid
  assignedByProfile   Profile?     @relation("profile_role_assignments_assignedByProfileIdToprofiles", fields: [assignedByProfileId], references: [id])
  profile             Profile?     @relation("profile_role_assignments_profileIdToprofiles", fields: [profileId], references: [id])
  role                ProfileRole? @relation(fields: [roleId], references: [id])

  @@map("profile_role_assignments")
}

// =============================================================================
// EMPLOYER DOMAIN
// =============================================================================

model Employer {
  id                        String                     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerCode              String?
  companyName               String?
  clientName                String?
  email                     String?
  passwordHash              String?
  phone                     String?
  altPhone                  String?
  registeredAddress         String?
  companyRegistrationNumber String?
  gstNumber                 String?
  isActive                  Boolean?
  isVerified                Boolean?
  verifiedAt                DateTime?                  @db.Timestamptz(6)
  lastLogin                 DateTime?                  @db.Timestamptz(6)
  createdAt                 DateTime?                  @db.Timestamptz(6)
  updatedAt                 DateTime?                  @db.Timestamptz(6)
  verifiedByProfileId       String?                    @db.Uuid
  deletedAt                 DateTime?                  @db.Timestamptz(6)
  deletedByProfileId        String?                    @db.Uuid
  status                    String?
  city                      String?
  district                  String?
  landmark                  String?
  postalCode                String?
  state                     String?
  logoUrl                   String?
  authorizedPersons         EmployerAuthorizedPerson[]
  statusHistory             EmployerStatusHistory[]
  deletedByProfile          Profile?                   @relation("employers_deletedByProfileIdToprofiles", fields: [deletedByProfileId], references: [id])
  verifiedByProfile         Profile?                   @relation("employers_verifiedByProfileIdToprofiles", fields: [verifiedByProfileId], references: [id])
  projectRequests           ProjectRequest[]
  projects                  Project[]

  @@map("employers")
}

model EmployerAuthorizedPerson {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId  String?   @db.Uuid
  name        String?
  designation String?
  email       String?
  phone       String?
  address     String?
  isPrimary   Boolean?
  createdAt   DateTime? @db.Timestamptz(6)
  updatedAt   DateTime? @db.Timestamptz(6)
  employer    Employer? @relation(fields: [employerId], references: [id])

  @@map("employer_authorized_persons")
}

model EmployerStatusHistory {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  employerId         String?   @db.Uuid
  previousStatus     String?
  newStatus          String?
  changedByProfileId String?   @db.Uuid
  changedAt          DateTime? @db.Timestamptz(6)
  reason             String?
  metadata           Json?
  changedByProfile   Profile?  @relation(fields: [changedByProfileId], references: [id])
  employer           Employer? @relation(fields: [employerId], references: [id])

  @@map("employer_status_history")
}

// =============================================================================
// PROJECT DOMAIN
// =============================================================================

model Project {
  id                      String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectCode             String?                      @unique
  name                    String?
  location                String?
  contactPhone            String?
  deploymentDate          DateTime?                    @db.Date
  awardDate               DateTime?                    @db.Date
  startDate               DateTime?                    @db.Date
  endDate                 DateTime?                    @db.Date
  revisedCompletionDate   DateTime?                    @db.Date
  projectManagerProfileId String?                      @db.Uuid
  description             String?
  poCoNumber              String?
  isActive                Boolean?
  isAccommodationProvided Boolean?
  createdAt               DateTime?                    @db.Timestamptz(6)
  updatedAt               DateTime?                    @db.Timestamptz(6)
  employerId              String?                      @db.Uuid
  createdByProfileId      String?                      @db.Uuid
  deletedAt               DateTime?                    @db.Timestamptz(6)
  deletedByProfileId      String?                      @db.Uuid
  actualStartDate         DateTime?                    @db.Date
  actualEndDate           DateTime?                    @db.Date
  terminationDate         DateTime?                    @db.Date
  completionDate          DateTime?                    @db.Date
  onHoldAttributableTo    String?
  shortCloseDate          DateTime?                    @db.Date
  stage                   String?
  stageChangeReason       String?
  stageChangedAt          DateTime?                    @db.Timestamptz(6)
  documents               ProjectDocument[]
  financials              ProjectFinancial[]
  resourceRequirements    ProjectResourceRequirement[]
  stageHistory            ProjectStageHistory[]
  workerAssignments       ProjectWorkerAssignment[]
  createdByProfile        Profile?                     @relation("projects_createdByProfileIdToprofiles", fields: [createdByProfileId], references: [id])
  deletedByProfile        Profile?                     @relation("projects_deletedByProfileIdToprofiles", fields: [deletedByProfileId], references: [id])
  employer                Employer?                    @relation(fields: [employerId], references: [id])
  projectManager          Profile?                     @relation("projects_projectManagerProfileIdToprofiles", fields: [projectManagerProfileId], references: [id])

  @@map("projects")
}

model ProjectStageHistory {
  id                 String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId          String?           @db.Uuid
  previousStage      String?
  newStage           String?
  reason             String?
  metadata           Json?
  changedByProfileId String?           @db.Uuid
  changedAt          DateTime?         @db.Timestamptz(6)
  documents          ProjectDocument[]
  changedByProfile   Profile?          @relation(fields: [changedByProfileId], references: [id])
  project            Project?          @relation(fields: [projectId], references: [id])

  @@map("project_stage_history")
}

model ProjectDocument {
  id                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId           String?              @db.Uuid
  documentType        String?
  documentUrl         String?
  fileName            String?
  uploadedByProfileId String?              @db.Uuid
  createdAt           DateTime?            @db.Timestamptz(6)
  updatedAt           DateTime?            @db.Timestamptz(6)
  stageHistoryId      String?              @db.Uuid
  project             Project?             @relation(fields: [projectId], references: [id])
  stageHistory        ProjectStageHistory? @relation(fields: [stageHistoryId], references: [id])
  uploadedByProfile   Profile?             @relation(fields: [uploadedByProfileId], references: [id])

  @@map("project_documents")
}

model ProjectFinancial {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId            String?   @db.Uuid
  contractValue        Decimal?  @db.Decimal
  revisedContractValue Decimal?  @db.Decimal
  variationOrderValue  Decimal?  @db.Decimal
  actualCostIncurred   Decimal?  @db.Decimal
  miscCost             Decimal?  @db.Decimal
  budget               Decimal?  @db.Decimal
  createdAt            DateTime? @db.Timestamptz(6)
  updatedAt            DateTime? @db.Timestamptz(6)
  project              Project?  @relation(fields: [projectId], references: [id])

  @@map("project_financials")
}

model ProjectResourceRequirement {
  id              String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  requiredCount   Int?
  createdAt       DateTime?      @db.Timestamptz(6)
  updatedAt       DateTime?      @db.Timestamptz(6)
  projectId       String?        @db.Uuid
  skillCategoryId String?        @db.Uuid
  project         Project?       @relation(fields: [projectId], references: [id])
  skillCategory   SkillCategory? @relation(fields: [skillCategoryId], references: [id])

  @@map("project_resource_requirements")
}

model ProjectWorkerAssignment {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectId           String?   @db.Uuid
  profileId           String?   @db.Uuid
  createdAt           DateTime? @db.Timestamptz(6)
  updatedAt           DateTime? @db.Timestamptz(6)
  assignedByProfileId String?   @db.Uuid
  removedAt           DateTime? @db.Timestamptz(6)
  removedByProfileId  String?   @db.Uuid
  removalReason       String?
  sharedAt            DateTime? @db.Timestamptz(6)
  sharedByProfileId   String?   @db.Uuid
  matchedAt           DateTime? @db.Timestamptz(6)
  assignedAt          DateTime? @db.Timestamptz(6)
  deployedAt          DateTime? @db.Timestamptz(6)
  stage               String?
  assignedByProfile   Profile?  @relation("project_worker_assignments_assignedByProfileIdToprofiles", fields: [assignedByProfileId], references: [id])
  profile             Profile?  @relation("project_worker_assignments_profileIdToprofiles", fields: [profileId], references: [id])
  project             Project?  @relation(fields: [projectId], references: [id])
  removedByProfile    Profile?  @relation("project_worker_assignments_removedByProfileIdToprofiles", fields: [removedByProfileId], references: [id])
  sharedByProfile     Profile?  @relation("project_worker_assignments_sharedByProfileIdToprofiles", fields: [sharedByProfileId], references: [id])

  @@map("project_worker_assignments")
}

// -----------------------------------------------------------------------------
// Project Requests
// -----------------------------------------------------------------------------

model ProjectRequest {
  id                    String                      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectTitle          String?
  projectDescription    String?
  location              String?
  estimatedStartDate    DateTime?                   @db.Date
  estimatedDurationDays Int?
  estimatedBudget       Decimal?                    @db.Decimal
  additionalNotes       String?
  status                String?
  reviewedAt            DateTime?                   @db.Timestamptz(6)
  createdAt             DateTime?                   @db.Timestamptz(6)
  updatedAt             DateTime?                   @db.Timestamptz(6)
  employerId            String?                     @db.Uuid
  projectId             String?                     @db.Uuid
  reviewedByProfileId   String?                     @db.Uuid
  requirements          ProjectRequestRequirement[]
  employer              Employer?                   @relation(fields: [employerId], references: [id])
  reviewedByProfile     Profile?                    @relation(fields: [reviewedByProfileId], references: [id])

  @@map("project_requests")
}

model ProjectRequestRequirement {
  id               String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectRequestId String?         @db.Uuid
  skillCategoryId  String?         @db.Uuid
  requiredCount    Int?
  createdAt        DateTime?       @db.Timestamptz(6)
  updatedAt        DateTime?       @db.Timestamptz(6)
  projectRequest   ProjectRequest? @relation(fields: [projectRequestId], references: [id])
  skillCategory    SkillCategory?  @relation(fields: [skillCategoryId], references: [id])

  @@map("project_request_requirements")
}

// =============================================================================
// TRAINING DOMAIN
// =============================================================================

model TrainingBatch {
  id                 String                       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code               String?
  name               String?
  programName        String?
  provider           String?
  startDate          DateTime?                    @db.Date
  endDate            DateTime?                    @db.Date
  durationDays       Int?
  maxCapacity        Int?
  status             String?
  location           String?
  description        String?
  createdAt          DateTime?                    @db.Timestamptz(6)
  updatedAt          DateTime?                    @db.Timestamptz(6)
  createdByProfileId String?                      @db.Uuid
  shift              String?
  certificates       ProfileTrainingCertificate[]
  enrollments        TrainingBatchEnrollment[]
  trainers           TrainingBatchTrainer[]
  createdByProfile   Profile?                     @relation(fields: [createdByProfileId], references: [id])
  trainingHistory    TrainingHistory[]

  @@map("training_batches")
}

model TrainingBatchEnrollment {
  id                        String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId                 String?        @db.Uuid
  batchId                   String?        @db.Uuid
  status                    String?
  notes                     String?
  isCustomSchedule          Boolean?
  droppedBeforeStart        Boolean?
  dropReason                String?
  enrollmentDate            DateTime?      @db.Timestamptz(6)
  completionDate            DateTime?      @db.Date
  actualStartDate           DateTime?      @db.Timestamptz(6)
  actualEndDate             DateTime?      @db.Timestamptz(6)
  enrolledByProfileId       String?        @db.Uuid
  forceCompletedByProfileId String?        @db.Uuid
  forceCompletedAt          DateTime?      @db.Timestamptz(6)
  forceCompletionReason     String?
  createdAt                 DateTime?      @db.Timestamptz(6)
  updatedAt                 DateTime?      @db.Timestamptz(6)
  batch                     TrainingBatch? @relation(fields: [batchId], references: [id])
  enrolledByProfile         Profile?       @relation("training_batch_enrollments_enrolledByProfileIdToprofiles", fields: [enrolledByProfileId], references: [id])
  forceCompletedByProfile   Profile?       @relation("training_batch_enrollments_forceCompletedByProfileIdToprofiles", fields: [forceCompletedByProfileId], references: [id])
  profile                   Profile?       @relation("training_batch_enrollments_profileIdToprofiles", fields: [profileId], references: [id])

  @@map("training_batch_enrollments")
}

model TrainingBatchTrainer {
  id                  String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  trainingBatchId     String?        @db.Uuid
  trainerProfileId    String?        @db.Uuid
  shift               String?        @db.VarChar(20) // "shift_1" or "shift_2"
  assignedAt          DateTime?      @db.Timestamptz(6)
  assignedByProfileId String?        @db.Uuid
  assignedByProfile   Profile?       @relation("training_batch_trainers_assignedByProfileIdToprofiles", fields: [assignedByProfileId], references: [id])
  trainerProfile      Profile?       @relation("training_batch_trainers_trainerProfileIdToprofiles", fields: [trainerProfileId], references: [id])
  trainingBatch       TrainingBatch? @relation(fields: [trainingBatchId], references: [id])

  @@unique([trainingBatchId, shift], name: "unique_batch_shift") // One trainer per shift per batch
  @@index([trainerProfileId], name: "idx_trainer_profile")
  @@map("training_batch_trainers")
}

model TrainingHistory {
  id                 String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId          String?        @db.Uuid
  trainingBatchId    String?        @db.Uuid
  eventType          String?
  startDate          DateTime?      @db.Timestamptz(6)
  endDate            DateTime?      @db.Timestamptz(6)
  forciblyCompleted  Boolean?       @default(false)
  eventAt            DateTime?      @db.Timestamptz(6)
  createdByProfileId String?        @db.Uuid
  notes              String?
  score              Decimal?       @db.Decimal
  metadata           Json?
  createdByProfile   Profile?       @relation("training_history_createdByProfileIdToprofiles", fields: [createdByProfileId], references: [id])
  profile            Profile?       @relation("training_history_profileIdToprofiles", fields: [profileId], references: [id])
  trainingBatch      TrainingBatch? @relation(fields: [trainingBatchId], references: [id])

  @@map("training_history")
}

model ProfileTrainingCertificate {
  id                   String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId            String?        @db.Uuid
  certificateNumber    String?
  trainingBatchId      String?        @db.Uuid
  issuedDate           DateTime?      @db.Timestamptz(6)
  issuedByProfileId    String?        @db.Uuid
  createdAt            DateTime?      @db.Timestamptz(6)
  updatedAt            DateTime?      @db.Timestamptz(6)
  certificateFileS3Key String?
  certificateFileUrl   String?
  issuedByProfile      Profile?       @relation("profile_training_certificates_issuedByProfileIdToprofiles", fields: [issuedByProfileId], references: [id])
  profile              Profile?       @relation("profile_training_certificates_profileIdToprofiles", fields: [profileId], references: [id])
  trainingBatch        TrainingBatch? @relation(fields: [trainingBatchId], references: [id])

  @@map("profile_training_certificates")
}

// =============================================================================
// NOTIFICATION DOMAIN
// =============================================================================

model Notification {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type               String?
  title              String?
  message            String?
  recipientProfileId String?   @db.Uuid
  recipientEmail     String?
  senderProfileId    String?   @db.Uuid
  metadata           Json?
  status             String?
  sentAt             DateTime? @db.Timestamptz(6)
  readAt             DateTime? @db.Timestamptz(6)
  errorMessage       String?
  retryCount         Int?
  createdAt          DateTime? @db.Timestamptz(6)
  updatedAt          DateTime? @db.Timestamptz(6)
  recipientProfile   Profile?  @relation("notifications_recipientProfileIdToprofiles", fields: [recipientProfileId], references: [id])
  senderProfile      Profile?  @relation("notifications_senderProfileIdToprofiles", fields: [senderProfileId], references: [id])

  @@map("notifications")
}

model NotificationChannel {
  id                 String                          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String?
  description        String?
  preferenceChannels NotificationPreferenceChannel[]
  templateChannels   NotificationTemplateChannel[]

  @@map("notification_channels")
}

model NotificationTemplate {
  id              String                        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type            String?
  name            String?
  description     String?
  subjectTemplate String?
  bodyTemplate    String?
  variables       Json?
  isActive        Boolean?
  createdAt       DateTime?                     @db.Timestamptz(6)
  updatedAt       DateTime?                     @db.Timestamptz(6)
  channels        NotificationTemplateChannel[]

  @@map("notification_templates")
}

model NotificationTemplateChannel {
  id                     String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  notificationTemplateId String?               @db.Uuid
  channelId              String?               @db.Uuid
  channel                NotificationChannel?  @relation(fields: [channelId], references: [id])
  notificationTemplate   NotificationTemplate? @relation(fields: [notificationTemplateId], references: [id])

  @@map("notification_template_channels")
}

model NotificationPreference {
  id               String                          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId        String?                         @db.Uuid
  notificationType String?
  isEnabled        Boolean?
  createdAt        DateTime?                       @db.Timestamptz(6)
  updatedAt        DateTime?                       @db.Timestamptz(6)
  channels         NotificationPreferenceChannel[]
  profile          Profile?                        @relation(fields: [profileId], references: [id])

  @@map("notification_preferences")
}

model NotificationPreferenceChannel {
  id                       String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  notificationPreferenceId String?                 @db.Uuid
  channelId                String?                 @db.Uuid
  channel                  NotificationChannel?    @relation(fields: [channelId], references: [id])
  notificationPreference   NotificationPreference? @relation(fields: [notificationPreferenceId], references: [id])

  @@map("notification_preference_channels")
}

// =============================================================================
// SOCIAL MEDIA DOMAIN
// =============================================================================

model SocialMediaPost {
  id               String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title            String?
  caption          String?
  description      String?
  content          String?
  imageUrl         String?
  videoUrl         String?
  projectName      String?
  sourceUrl        String?
  status           String?
  scheduledAt      DateTime?                 @db.Timestamptz(6)
  publishedAt      DateTime?                 @db.Timestamptz(6)
  makeResponse     Json?
  makeWebhookId    String?
  platformContent  Json?
  youtubeCategory  String?
  youtubePrivacy   String?
  youtubeThumbnail String?
  engagement       Json?
  createdBy        String?
  createdAt        DateTime?                 @db.Timestamptz(6)
  updatedAt        DateTime?                 @db.Timestamptz(6)
  platformPosts    SocialMediaPlatformPost[]
  media            SocialMediaPostMedia[]
  platforms        SocialMediaPostPlatform[]
  tags             SocialMediaPostTag[]

  @@map("social_media_posts")
}

model SocialMediaPlatformPost {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  platform       String?
  platformPostId String?
  status         String?
  publishedAt    DateTime?        @db.Timestamptz(6)
  errorMessage   String?
  engagement     Json?
  createdAt      DateTime?        @db.Timestamptz(6)
  updatedAt      DateTime?        @db.Timestamptz(6)
  postId         String?          @db.Uuid
  post           SocialMediaPost? @relation(fields: [postId], references: [id])

  @@map("social_media_platform_posts")
}

model SocialMediaPostMedia {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  socialMediaPostId String?          @db.Uuid
  url               String?
  mediaType         String?
  orderIndex        Int?
  post              SocialMediaPost? @relation(fields: [socialMediaPostId], references: [id])

  @@map("social_media_post_media")
}

model SocialMediaPostPlatform {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  socialMediaPostId String?          @db.Uuid
  platform          String?
  platformPostId    String?
  status            String?
  publishedAt       DateTime?        @db.Timestamptz(6)
  errorMessage      String?
  metadata          Json?
  post              SocialMediaPost? @relation(fields: [socialMediaPostId], references: [id])

  @@map("social_media_post_platforms")
}

model SocialMediaPostTag {
  id                String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  socialMediaPostId String?          @db.Uuid
  tag               String?
  post              SocialMediaPost? @relation(fields: [socialMediaPostId], references: [id])

  @@map("social_media_post_tags")
}

// =============================================================================
// SCRAPER & NEWS DOMAIN
// =============================================================================

model ScraperWebsite {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  url       String?
  type      String?
  isActive  Boolean?
  createdAt DateTime? @db.Timestamptz(6)
  updatedAt DateTime? @db.Timestamptz(6)
  name      String?

  @@map("scraper_websites")
}

model ScraperRun {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  status               String?
  startedAt            DateTime? @db.Timestamptz(6)
  completedAt          DateTime? @db.Timestamptz(6)
  durationMs           Int?
  totalUrlsFound       Int?
  totalArticlesScraped Int?
  totalValidProjects   Int?
  totalInserted        Int?
  totalDuplicates      Int?
  errorsCount          Int?
  errors               Json?
  metrics              Json?
  insertedProjectIds   Json?
  triggeredBy          String?
  createdAt            DateTime? @db.Timestamptz(6)

  @@map("scraper_runs")
}

model NewsUpdate {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  projectName      String?
  sector           String?
  companyAuthority String?
  location         String?
  valueCr          Decimal?  @db.Decimal
  status           String?
  revisedBudget    Decimal?  @db.Decimal
  revisedTimeline  String?
  delayReason      String?
  sourceUrl        String?
  sourceType       String?
  summaryRemarks   String?
  scrapedDate      DateTime? @db.Timestamptz(6)
  createdAt        DateTime? @db.Timestamptz(6)
  updatedAt        DateTime? @db.Timestamptz(6)

  @@map("news_updates")
}

// =============================================================================
// UTILITIES & SYSTEM
// =============================================================================

model ActivityLog {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  action    String?
  module    String?
  recordId  String?
  oldValue  String?
  newValue  String?
  ipAddress String?
  userAgent String?
  createdAt DateTime? @db.Timestamptz(6)
  profileId String?   @db.Uuid
  profile   Profile?  @relation(fields: [profileId], references: [id])

  @@map("activity_logs")
}

model Blog {
  id                 BigInt    @id @default(autoincrement())
  createdAt          DateTime? @db.Timestamptz(6)
  title              String?
  content            String?
  imageUrl           String?
  category           String?
  createdByProfileId String?   @db.Uuid

  @@map("blogs")
}

model CalendarEvent {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  profileId      String?   @db.Uuid
  eventType      String?
  referenceTable String?
  referenceId    String?   @db.Uuid
  startDate      DateTime? @db.Timestamptz(6)
  endDate        DateTime? @db.Timestamptz(6)
  status         String?
  createdAt      DateTime? @db.Timestamptz(6)
  updatedAt      DateTime? @db.Timestamptz(6)
  profile        Profile?  @relation(fields: [profileId], references: [id])

  @@map("calendar_events")
}

model StatusTrail {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  entityName         String?
  entityPrimaryId    String?   @db.Uuid
  statusType         String?
  previousStatus     String?
  newStatus          String?
  changedByProfileId String?   @db.Uuid
  changedAt          DateTime? @db.Timestamptz(6)
  remarks            String?
  metadata           Json?

  @@map("status_trails")
}
